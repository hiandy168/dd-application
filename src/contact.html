<!DOCTYPE html>
<html>
    <head>
        <title>有范钉钉通讯录</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
        <link rel="shortcut icon" type="image/x-icon" href=""/>
        <meta name="keywords" content=""/>
        <meta name="description" content=""/>
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="format-detection" content="telephone=no">
        <meta name="author" content="" />
        <meta name="copyright" content=""/>
        <link rel="stylesheet" href="./css/task.css"/>
    </head>
    <body>

        <script src="//g.alicdn.com/ilw/cdnjs/jquery/2.1.4/jquery.min.js"></script>
        <script src="//g.alicdn.com/ilw/ding/0.6.2/scripts/dingtalk.js"></script>
        <script src="./js/fastclick.js"></script>
        <script src="./js/config.js"></script>
        <script type="text/javascript">
            dd.config({
                agentId: agentId,
                corpId: corpId,
                timeStamp: timeStamp,
                nonceStr: nonceStr,
                signature: '52b6f13d94b69bc02cc1645dde280ac7f9214fa8',
                jsApiList: [
                    'runtime.info',
                    'device.notification.prompt',
                    'biz.chat.pickConversation',
                    'device.notification.confirm',
                    'device.notification.alert',
                    'device.notification.prompt',
                    'biz.chat.open',
                    'biz.util.open',
                    'biz.user.get',
                    'biz.contact.choose',
                    'biz.telephone.call',
                    'biz.ding.post']
            });
            alert("agentId:"+agentId+"corpId:"+corpId);
            dd.ready(function(){
                alert("dd ready22");
//                $.ajax({
//                    url:apiUrl+'department/list',
//                    dataType:'json',
//                    data:{access_token:access_token},
//                    type:'GET',
//                    success:function(data){
//                        alert(data.department[0].name);
//                    },
//                    error:function(data){
//                        alert(JSON.stringify(data));
//                    }
//                })
                dd.runtime.info({
                    onSuccess: function(result) {

                        console.log(JSON.stringify(result));
                        alert(JSON.stringify(result));
                    },
                    onFail : function(err) {
                        alert(JSON.stringify(err));


                    }

                });

//                获取免登授权码
                dd.runtime.permission.requestAuthCode({
                    corpId: corpId,
                    onSuccess: function(result) {
                        /*{
                         code: 'hYLK98jkf0m' //string authCode
                         }*/
                        alert(JSON.stringify(result));
                    },
                    onFail : function(err) {
                        alert(JSON.stringify(err))
                    }

                });
                dd.device.notification.alert({
                    message: "hello",
                    title: "我是一个测试应用",//可传空
                    buttonName: "ok",
                    onSuccess : function() {
                        //onSuccess将在点击button之后回调
                        /*回调*/
                        alert("ok");
                    },
                    onFail : function(err) {}
                });
            })
            dd.error(function(err) {
                alert("dderror"+JSON.stringify(err));
                logger.e('dd error: ' + JSON.stringify(err));
            });

        </script>

    </body>
</html>
